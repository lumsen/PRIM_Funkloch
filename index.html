<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' https://maps.googleapis.com https://www.google.com https://fonts.googleapis.com https://d3js.org; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; frame-src https://www.google.com https://*.google.com; default-src 'self';">
    <title>Funknetzwerk-Visualisierung</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
    <link rel="stylesheet" href="src/css/style.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>

    <header class="main-header">
        <div class="header-content">
            <h1>Funknetzwerk-Visualisierung</h1>
            <label for="dark-mode-toggle" class="dark-mode-switch">
                <input type="checkbox" id="dark-mode-toggle">
                <span class="slider"></span>
            </label>
        </div>
    </header>

    <main class="container">
        <div class="info-section">
            <h2>Über das Spiel: PRIM Funkloch</h2>
            <p>
                Willkommen bei PRIM Funkloch, einem strategischen Planungstool zur Verwaltung von Trupps und Einsätzen in einem postapokalyptischen Szenario.
                Ihre Aufgabe ist es, Kommunikationsbrücken zwischen wichtigen Orten aufzubauen und aufrechtzuerhalten, während Sie verschiedene Risikostufen und Truppeneigenschaften berücksichtigen.
            </p>
            <h3>Prämisse</h3>
            <p>
                Nach einem katastrophalen Ereignis ist die Kommunikation zusammengebrochen. Sie sind Teil einer Einheit, die versucht, ein Funknetzwerk wiederherzustellen.
                Dazu müssen Sie Trupps entsenden, die Relaispunkte besetzen und Batterien für Techniktrupps transportieren.
                Jeder Einsatz birgt Risiken, und die Ressourcen sind begrenzt.
            </p>
            <h3>Regeln und Eigenschaften</h3>
            <ul>
                <li><b>Trupps:</b> Es gibt zwei Haupttypen von Trupps:
                    <ul>
                        <li><b>Techniktrupps (BeROp-[XX]):</b> Diese sind mobil (10 km/h) und dienen als Relaispunkte. Sie benötigen Batterien, die von regulären Trupps geliefert werden müssen. Ihre Reichweite von 50 km bezieht sich auf die Abdeckung als Relais.</li>
                        <li><b>Reguläre Trupps (WD-[XX], BER-[XX], BAST-[XX]):</b> Diese Trupps sind mobil und können Batterien transportieren. Ihre Stärke variiert von 4-10, Geschwindigkeit von 4-8 km/h und Reichweite beträgt 25 km. Ihre Ausrüstung ist entscheidend für die Bewältigung von Risiken.</li>
                    </ul>
                </li>
                <li><b>Risikostufen:</b> Jede Verbindung zwischen Orten hat eine Risikostufe (R0-R5), die die Anforderungen an die Truppstärke und Ausrüstung beeinflusst.
                    <ul>
                        <li><b>R1 (Sicher):</b> Geringes Risiko.</li>
                        <li><b>R2 (Mittel):</b> Mittleres Risiko.</li>
                        <li><b>R3 (Hoch):</b> Hohes Risiko.</li>
                        <li><b>R4 (Sehr Hoch):</b> Erfordert spezielle Ausrüstung (CombatMedic oder Überwachung).</li>
                        <li><b>R5 (Kritisch):</b> Erfordert spezielle Ausrüstung (Veteran).</li>
                    </ul>
                </li>
                <li><b>Batterien und Ladestationen:</b> Techniktrupps verbrauchen Batterien. Leere Batterien müssen von regulären Trupps zu Ladestationen (Wannsee, Bahnitz) gebracht, aufgeladen und wieder zu den Techniktrupps zurücktransportiert werden.</li>
                <li><b>Einsatzplanung:</b> Planen Sie Einsätze sorgfältig, um Kommunikationsbrücken aufrechtzuerhalten und Trupps effizient einzusetzen. Berücksichtigen Sie die Verfügbarkeit der Trupps und ihre Ruhezeiten.</li>
            </ul>
        </div>

        <div class="main-content">
            <div id="graph-container">
                <div id="legend">
                    <h4>Risikostufen</h4>
                    <div class="legend-item"><div class="legend-color" style="background-color: #28a745;"></div>Sicher (R1)</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #ffc107;"></div>Mittel (R2)</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #fd7e14;"></div>Hoch (R3)</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #dc3545;"></div>Sehr Hoch (R4)</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #8B0000;"></div>Kritisch (R5)</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #6c757d;"></div>Unbekannt (R0)</div>
                </div>
                <div id="timeline-legend" class="legend">
                    <h4>Zeitliche Visualisierung</h4>
                    <div class="legend-item"><div class="legend-color" style="background-color: #00ccff;"></div>Kommunikationsbrücke (Relais)</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #9932CC;"></div>Trupp-Bewegung</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #FFD700;"></div>Versorgungsmission</div>
                    <div class="legend-item"><div class="legend-color" style="background-color: #ff6347;"></div>Aktiver Knoten</div>
                </div>
                <h2>Graph des Funknetzwerks (SL_Only)</h2>
                <svg id="graph" viewBox="0 0 960 600" preserveAspectRatio="xMidYMid meet"></svg>
                <div id="timeline-controls" style="margin-top: 20px; text-align: center;">
                    <input type="range" id="time-slider" min="0" max="100" value="0" style="width: 80%;">
                    <div id="current-time-display" style="margin-top: 10px; font-weight: bold;"></div>
                </div>
            </div>
            <div id="map-container">
                <h2>Geografische Kartenansicht</h2>
                <iframe src="https://www.google.com/maps/d/embed?mid=1LMTw9AeHnCRatB0koPwfw2Z2VHz5cNU&ehbc=2E312F&noprof=1"></iframe>
            </div>
        </div>

        <div class="table-container" id="matrix-container">
            <div class="table-header">
                <h2>Kommunikationsmatrix: Orte und Verbindungen</h2>
                <div>
                    <button id="export-button" class="btn btn-primary">Aktuelle Daten exportieren</button>
                    <button id="reset-button" class="btn btn-danger">Daten zurücksetzen</button>
                </div>
            </div>
            <table>
                <thead></thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="table-container">
            <h2>Trupps</h2>
            <table id="trupps-table">
                <thead>
                    <tr>
                        <th>Name
                            <span class="tooltip-container">
                                <span class="info-icon">?</span>
                                <span class="tooltip">Eindeutiger Name des Trupps. Techniktrupps beginnen mit 'BeROp-', andere Trupps mit 'WD-', 'BER-' oder 'BAST-'.</span>
                            </span>
                        </th>
                        <th>Truppstärke
                            <span class="tooltip-container">
                                <span class="info-icon">?</span>
                                <span class="tooltip">Die Stärke des Trupps, beeinflusst die Fähigkeit, Risikostufen zu bewältigen.</span>
                            </span>
                        </th>
                        <th>Reichweite (km)
                            <span class="tooltip-container">
                                <span class="info-icon">?</span>
                                <span class="tooltip">Maximale Distanz, die der Trupp in einem Einsatz abdecken kann. Techniktrupps haben eine Relais-Reichweite von 50 km, reguläre Trupps 25 km.</span>
                            </span>
                        </th>
                        <th>Bewegungsgeschwindigkeit (km/h)
                            <span class="tooltip-container">
                                <span class="info-icon">?</span>
                                <span class="tooltip">Geschwindigkeit, mit der sich der Trupp zwischen Einsatzpunkten bewegt. Techniktrupps haben eine Geschwindigkeit von 10 km/h.</span>
                            </span>
                        </th>
                        <th>Ruhezeit (h)
                            <span class="tooltip-container">
                                <span class="info-icon">?</span>
                                <span class="tooltip">Erforderliche Ruhezeit nach einem Einsatz, bevor der Trupp wieder verfügbar ist.</span>
                            </span>
                        </th>
                        <th>Ausrüstung
                            <span class="tooltip-container">
                                <span class="info-icon">?</span>
                                <span class="tooltip">
                                    <b>CombatMedic:</b> Wird benötigt ab Risiko 4.<br>
                                    <b>Überwachung:</b> Alternative zu CombatMedic bei Risiko 4.<br>
                                    <b>Veteran:</b> Überlebensnotwendig bei Risiko 5.<br>
                                    <b>Batterie:</b> Spezielle Ausrüstung für Techniktrupps zur Energieversorgung.
                                </span>
                            </span>
                        </th>
                        <th>Aktueller Einsatzpunkt
                            <span class="tooltip-container">
                                <span class="info-icon">?</span>
                                <span class="tooltip">Der aktuelle geografische Standort des Trupps.</span>
                            </span>
                        </th>
                        <th>Aktionen</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Trupp-Daten werden hier per JavaScript eingefügt -->
                </tbody>
            </table>
            <div class="add-form-container">
                <h3>Neuen Trupp hinzufügen</h3>
                <form id="add-trupp-form" class="add-form">
                    <input type="text" id="trupp-name" placeholder="Name" required>
                    <input type="number" id="trupp-staerke" placeholder="Truppstärke" required>
                    <input type="number" id="trupp-reichweite" placeholder="Reichweite" required>
                    <input type="number" id="trupp-geschwindigkeit" placeholder="Geschwindigkeit" required>
                    <input type="number" id="trupp-ruhezeit" placeholder="Ruhezeit" required>
                    <input type="text" id="trupp-ausruestung" placeholder="Ausrüstung" required>
                    <button type="submit" class="btn btn-primary">Hinzufügen</button>
                </form>
            </div>
        </div>

        <div class="table-container">
            <h2>Einsätze</h2>
            <table id="einsaetze-table">
                <thead>
                    <tr>
                        <th>Truppname</th>
                        <th>Startzeit</th>
                        <th>Startort</th>
                        <th>Endort</th>
                        <th>Endzeit</th>
                        <th>Missionstyp</th>
                        <th>Aktionen</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Einsatz-Daten werden hier per JavaScript eingefügt -->
                </tbody>
            </table>
            <div class="add-form-container">
                <h3>Neuen Einsatz hinzufügen</h3>
                <form id="add-einsatz-form" class="add-form">
                    <input type="text" id="einsatz-truppname" placeholder="Truppname" required>
                    <input type="text" id="einsatz-startzeit" placeholder="Startzeit" required>
                    <input type="text" id="einsatz-startort" placeholder="Startort" required>
                    <input type="text" id="einsatz-endort" placeholder="Endort" required>
                    <input type="text" id="einsatz-endzeit" placeholder="Endzeit" required>
                    <button type="submit" class="btn btn-primary">Hinzufügen</button>
                </form>
            </div>
            <button id="generate-einsaetze-button" class="btn btn-primary" style="margin-top: 10px;">Einsätze generieren</button>
        </div>
    </main>

    <script type="module" src="src/js/script.js"></script>
</body>
</html>
